<div id="navigation-drawer" [@openClose]="collapsed ? 'closed' : 'open'">
  <div class="navigation-drawer__top" [ngStyle]="{}">
    <button
      mat-icon-button
      matTooltip="Basic"
      (click)="ToggleCollapse()"
      aria-label="Example icon-button with a heart icon"
    >
      <mat-icon fontSet="material-symbols-outlined">{{ collapsed ? 'menu' : 'chevron_left' }}</mat-icon>
    </button>
    @if (!this.collapsed) {
      <p @showUserButton>Clip</p>
    }
  </div>

  <div class="entries">
    <!-- 1st level -->
    <ng-container *ngFor="let element of navigationElementsTree">
      <div
        class="navigation-entry"
        [ngClass]="{
          'navigation-entry-wide': this.collapsed,
          'navigation-entry-expanded': element.isExpanded,
        }"
      >
        <m3-button
          *ngIf="element.type == 'button'"
          [icon-filled]="element.rippled"
          [Icon]="element.icon"
          [Rippled]="element.rippled"
          Type="sidenav-left"
          [Text]="collapsed ? '' : element.name"
          (click)="navigate(element)"
        >
        </m3-button>

        <div [@separatorDisappear]="this.collapsed" *ngIf="element.type == 'tag'" class="navigation-separator"></div>

        <mat-chip *ngIf="!this.collapsed && element.type == 'tag'" color="primary">
          {{ element.name }}
        </mat-chip>
        <!-- 2nd level -->
        <ng-container *ngIf="element.isExpanded">
          <div class="navigation-entry-subelements">
            <div class="navigation-entry-subelements-left">
              <div class="navigation-entry-subelements-left-spacer"></div>
            </div>
            <div class="navigation-entry-subelements-right">
              <ng-container *ngFor="let element_1 of element.subElements">
                <mat-chip *ngIf="element_1.type == 'tag'" color="primary">
                  {{ element_1.name }}
                </mat-chip>
                <m3-button
                  *ngIf="element_1.type == 'button'"
                  Type="thin"
                  [Icon]="element_1.icon"
                  [icon-filled]="element_1.rippled"
                  [Text]="collapsed ? '' : element_1.name"
                  [Rippled]="element_1.rippled"
                  (click)="navigate(element_1, element)"
                >
                </m3-button>
              </ng-container>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </div>

  <div style="margin: auto 0px"></div>

  <div [class]="collapsed ? 'user-widget-collapsed' : 'user-widget'">
    <div class="user-widget-content">
      <img
        (click)="forceUserWidgetExpand()"
        [src]="userService.currentUserAvatarUrl"
        alt="avatar"
        style="width: 40px; height: 40px; border-radius: 50%"
      />
      <p>{{ userService.loggedOnUser?.name }} {{ userService.loggedOnUser?.surname }}</p>
      <button
        mat-icon-button
        color="primary"
        class="user-widget-expand"
        (click)="userWidgetCollapsed = !userWidgetCollapsed"
      >
        <mat-icon fontSet="material-symbols-outlined">{{
          userWidgetCollapsed ? 'collapse_all' : 'expand_all'
        }}</mat-icon>
      </button>
    </div>
    @if (!userWidgetCollapsed) {
      <div class="user-widget-actions">
        <div [formGroup]="themeForm">
          <mat-form-field
            color="accent"
            (cdkObserveContent)="themeService.setThemeByString(themeForm.value.theme)"
            class="marginated"
          >
            <mat-label>Theme</mat-label>
            <mat-select [formControlName]="'theme'">
              <mat-option [value]="'clip-light'">White theme</mat-option>
              <mat-option [value]="'clip-dark'">Black theme</mat-option>
              <mat-option [value]="'clip-grey'">Grey theme</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <p>Clip server version 0.1.0</p>
        <div class="user-widget-actions-row">
          <button mat-button color="accent" (click)="router.navigateByUrl('/settings')">
            Settings
            <mat-icon fontSet="material-symbols-outlined">settings</mat-icon>
          </button>
          <button mat-icon-button color="warn">
            <mat-icon fontSet="material-symbols-outlined">logout</mat-icon>
          </button>
        </div>
      </div>
    }
  </div>
</div>
